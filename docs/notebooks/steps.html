
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>All steps &#8212; riskmapjnr — Map of deforestation risk following JNR methodology</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Python API" href="../reference.html" />
    <link rel="prev" title="Articles" href="../articles.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo-riskmapjnr.svg" alt="Logo"/>
    
    <h1 class="logo logo-name">riskmapjnr</h1>
    
  </a>
</p>



<p class="blurb">Map of deforestation risk following JNR methodology</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=ghislainv&repo=riskmapjnr&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="get_started.html">Get Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../articles.html">Articles</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="get_started.html">Get Started</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">All steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../indices.html">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../articles.html">Articles</a><ul>
      <li>Previous: <a href="../articles.html" title="previous chapter">Articles</a></li>
      <li>Next: <a href="../reference.html" title="next chapter">Python API</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="all-steps">
<h1>All steps<a class="headerlink" href="#all-steps" title="Permalink to this heading">¶</a></h1>
<section id="introduction">
<h2>1 Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<section id="objective">
<h3>1.1 Objective<a class="headerlink" href="#objective" title="Permalink to this heading">¶</a></h3>
<p>We present here all the steps of the JNR methodology that need to be followed to derive a map of the deforestation risk in a given jurisdiction.</p>
</section>
<section id="importing-python-modules">
<h3>1.2 Importing Python modules<a class="headerlink" href="#importing-python-modules" title="Permalink to this heading">¶</a></h3>
<p>We import the Python modules needed for running the analysis.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pkg_resources</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">riskmapjnr</span> <span class="k">as</span> <span class="nn">rmj</span>
</pre></div>
</div>
<p>Increase the cache for GDAL to increase computational speed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># GDAL</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;GDAL_CACHEMAX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1024&quot;</span>
</pre></div>
</div>
<p>Set the <code class="docutils literal notranslate"><span class="pre">PROJ_LIB</span></code> environmental variable.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PROJ_LIB&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/home/ghislain/.pyenv/versions/miniconda3-latest/envs/conda-rmj/share/proj&quot;</span>
</pre></div>
</div>
<p>Create a directory to save results.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">out_dir</span> <span class="o">=</span> <span class="s2">&quot;outputs_steps&quot;</span>
<span class="n">rmj</span><span class="o">.</span><span class="n">make_dir</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="forest-cover-change-data">
<h3>1.3 Forest cover change data<a class="headerlink" href="#forest-cover-change-data" title="Permalink to this heading">¶</a></h3>
<p>We use the Guadeloupe archipelago as a case study. Recent forest cover change data for Guadeloupe is included in the <code class="docutils literal notranslate"><span class="pre">riskmapjnr</span></code> package. The raster file (<code class="docutils literal notranslate"><span class="pre">fcc123_GLP.tif</span></code>) includes the following values: <strong>1</strong> for deforestation on the period 2000–2010, <strong>2</strong> for deforestation on the period 2010–2020, and <strong>3</strong> for the remaining forest in 2020. NoData value is set to <strong>0</strong>. The first period (2000–2010) will be used for calibration and the second period (2010–2020) will be used for validation. This is the only data we need to derive a map of deforestation risk following the JNR methodology.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fcc_file</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s2">&quot;riskmapjnr&quot;</span><span class="p">,</span> <span class="s2">&quot;data/fcc123_GLP.tif&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fcc_file</span><span class="p">)</span>
<span class="n">border_file</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s2">&quot;riskmapjnr&quot;</span><span class="p">,</span> <span class="s2">&quot;data/ctry_border_GLP.gpkg&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">border_file</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ghislain</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">riskmapjnr</span><span class="o">/</span><span class="n">riskmapjnr</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">fcc123_GLP</span><span class="o">.</span><span class="n">tif</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">ghislain</span><span class="o">/</span><span class="n">Code</span><span class="o">/</span><span class="n">riskmapjnr</span><span class="o">/</span><span class="n">riskmapjnr</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">ctry_border_GLP</span><span class="o">.</span><span class="n">gpkg</span>
</pre></div>
</div>
<p>We plot the forest cover change map with the <code class="docutils literal notranslate"><span class="pre">plot.fcc123()</span></code> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ofile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;fcc123.png&quot;</span><span class="p">)</span>
<span class="n">fig_fcc123</span> <span class="o">=</span> <span class="n">rmj</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">fcc123</span><span class="p">(</span>
    <span class="n">input_fcc_raster</span><span class="o">=</span><span class="n">fcc_file</span><span class="p">,</span>
    <span class="n">maxpixels</span><span class="o">=</span><span class="mf">1e8</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span>
    <span class="n">borders</span><span class="o">=</span><span class="n">border_file</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
<span class="n">ofile</span>
</pre></div>
</div>
<figure class="align-default" id="id1">
<span id="fig-steps-fccmap"></span><a class="reference internal image-reference" href="../_images/fcc1231.png"><img alt="../_images/fcc1231.png" src="../_images/fcc1231.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Forest cover change map.</strong> Deforestation on the first period (2000–2010) is in orange, deforestation on the second period (2000–2020) is in red and remaining forest (in 2020) is in green.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="deforestation-risk-and-distance-to-forest-edge">
<h2>2 Deforestation risk and distance to forest edge<a class="headerlink" href="#deforestation-risk-and-distance-to-forest-edge" title="Permalink to this heading">¶</a></h2>
<p>The first step is to compute the distance to the forest edge after which the risk of deforestation becomes negligible. Indeed, it is known from previous studies on tropical deforestation that the deforestation risk decreases rapidly with the distance to the forest edge and that most of the deforestation occurs close to the forest edge (Vieilledent et al., 2013, Grinand et al., 2020, Vieilledent, 2021, Dezécache et al., 2017). The JNR methodology suggests identifying the distance to the forest edge <span class="math notranslate nohighlight">\(d\)</span>, so that at least 99% of the deforestation occurs within a distance <span class="math notranslate nohighlight">\(\leq d\)</span>. Forest areas located at a distance from the forest edge <span class="math notranslate nohighlight">\(\gt d\)</span> can be considered as having no risk of being deforested. As a consequence, forest pixels with a distance from the forest edge <span class="math notranslate nohighlight">\(\gt d\)</span> are assigned category 0 (zero) for the deforestation risk.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ofile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;perc_dist.png&quot;</span><span class="p">)</span>
<span class="n">dist_edge_thres</span> <span class="o">=</span> <span class="n">rmj</span><span class="o">.</span><span class="n">dist_edge_threshold</span><span class="p">(</span>
    <span class="n">fcc_file</span><span class="o">=</span><span class="n">fcc_file</span><span class="p">,</span>
    <span class="n">defor_values</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">dist_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;dist_edge.tif&quot;</span><span class="p">),</span>
    <span class="n">dist_bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1080</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
    <span class="n">tab_file_dist</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;tab_dist.csv&quot;</span><span class="p">),</span>
    <span class="n">fig_file_dist</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span>
    <span class="n">blk_rows</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ofile</span>
</pre></div>
</div>
<figure class="align-default" id="id2">
<span id="fig-steps-dist-edge"></span><a class="reference internal image-reference" href="../_images/perc_dist1.png"><img alt="../_images/perc_dist1.png" src="../_images/perc_dist1.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Identifying areas for which the risk of deforestation is negligible.</strong> Figure shows that more than 99% of the deforestation occurs within a distance from the forest edge ≤ 120 m. Forest areas located at a distance &gt; 120 m from the forest edge can be considered as having no risk of being deforested.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The function returns a dictionnary including the distance threshold.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dist_thresh</span> <span class="o">=</span> <span class="n">dist_edge_thres</span><span class="p">[</span><span class="s2">&quot;dist_thresh&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The distance threshold is </span><span class="si">{</span><span class="n">dist_thresh</span><span class="si">}</span><span class="s2"> m&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">distance</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="mi">120</span> <span class="n">m</span>
</pre></div>
</div>
<p>A table indicating the cumulative percentage of deforestation as a function of the distance is also produced:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Distance</p></th>
<th class="head"><p>Npixels</p></th>
<th class="head"><p>Area</p></th>
<th class="head"><p>Cumulation</p></th>
<th class="head"><p>Percentage</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>30</p></td>
<td><p>24937</p></td>
<td><p>2244.33</p></td>
<td><p>2244.33</p></td>
<td><p>83.583</p></td>
</tr>
<tr class="row-odd"><td><p>60</p></td>
<td><p>3451</p></td>
<td><p>310.59</p></td>
<td><p>2554.92</p></td>
<td><p>95.15</p></td>
</tr>
<tr class="row-even"><td><p>90</p></td>
<td><p>1001</p></td>
<td><p>90.09</p></td>
<td><p>2645.01</p></td>
<td><p>98.5051</p></td>
</tr>
<tr class="row-odd"><td><p>120</p></td>
<td><p>282</p></td>
<td><p>25.38</p></td>
<td><p>2670.39</p></td>
<td><p>99.4503</p></td>
</tr>
<tr class="row-even"><td><p>150</p></td>
<td><p>102</p></td>
<td><p>9.18</p></td>
<td><p>2679.57</p></td>
<td><p>99.7922</p></td>
</tr>
<tr class="row-odd"><td><p>180</p></td>
<td><p>29</p></td>
<td><p>2.61</p></td>
<td><p>2682.18</p></td>
<td><p>99.8894</p></td>
</tr>
<tr class="row-even"><td><p>210</p></td>
<td><p>14</p></td>
<td><p>1.26</p></td>
<td><p>2683.44</p></td>
<td><p>99.9363</p></td>
</tr>
<tr class="row-odd"><td><p>240</p></td>
<td><p>6</p></td>
<td><p>0.54</p></td>
<td><p>2683.98</p></td>
<td><p>99.9564</p></td>
</tr>
<tr class="row-even"><td><p>270</p></td>
<td><p>2</p></td>
<td><p>0.18</p></td>
<td><p>2684.16</p></td>
<td><p>99.9631</p></td>
</tr>
<tr class="row-odd"><td><p>300</p></td>
<td><p>3</p></td>
<td><p>0.27</p></td>
<td><p>2684.43</p></td>
<td><p>99.9732</p></td>
</tr>
</tbody>
</table>
</section>
<section id="local-deforestation-rate">
<h2>3 Local deforestation rate<a class="headerlink" href="#local-deforestation-rate" title="Permalink to this heading">¶</a></h2>
<p>The second step is to compute a local risk of deforestation at the pixel level using a moving window made of several pixels. The deforestation risk is estimated from the deforestation rate inside the moving window. The deforestation rate <span class="math notranslate nohighlight">\(\theta\)</span> (in %/yr) is computed from the formula <span class="math notranslate nohighlight">\(\theta=(\alpha_2/\alpha_1)^{1/\tau}-1\)</span>, with <span class="math notranslate nohighlight">\(\alpha\)</span> the forest areas (in ha) at time <span class="math notranslate nohighlight">\(t_1\)</span> and <span class="math notranslate nohighlight">\(t_2\)</span>, and <span class="math notranslate nohighlight">\(\tau\)</span>, the time interval (in yr) between time <span class="math notranslate nohighlight">\(t_1\)</span> and <span class="math notranslate nohighlight">\(t_2\)</span>. Using the deforestation rate formula, the moving window and the past forest cover change map, we can derive a raster map describing the local risk of deforestation at the same resolution as the input map.</p>
<p>To save space on disk, deforestation rates are converted to integer values between 0 and 10000 (ten thousand) and the raster type is set to UInt16. This ensures a precision of 10<sup>-4</sup>for the deforestation rate which is sufficient to determine the 30 categories of deforestation risk, as imposed by the JNR methodology.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set window size</span>
<span class="n">s</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c1"># Compute local deforestation rate</span>
<span class="n">rmj</span><span class="o">.</span><span class="n">local_defor_rate</span><span class="p">(</span>
    <span class="n">fcc_file</span><span class="o">=</span><span class="n">fcc_file</span><span class="p">,</span>
    <span class="n">defor_values</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">ldefrate_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ldefrate.tif&quot;</span><span class="p">),</span>
    <span class="n">win_size</span><span class="o">=</span><span class="n">s</span><span class="p">,</span>
    <span class="n">time_interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">blk_rows</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="pixels-with-zero-risk-of-deforestation">
<h2>4 Pixels with zero risk of deforestation<a class="headerlink" href="#pixels-with-zero-risk-of-deforestation" title="Permalink to this heading">¶</a></h2>
<p>This third step sets a value of 10001 to pixels with zero deforestation risk. As explained previously, a risk of deforestation of zero is assumed when distance to forest edge is greater than the distance below which more than 99% of the deforestation occurs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rmj</span><span class="o">.</span><span class="n">set_defor_cat_zero</span><span class="p">(</span>
    <span class="n">ldefrate_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ldefrate.tif&quot;</span><span class="p">),</span>
    <span class="n">dist_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;dist_edge.tif&quot;</span><span class="p">),</span>
    <span class="n">dist_thresh</span><span class="o">=</span><span class="n">dist_thresh</span><span class="p">,</span>
    <span class="n">ldefrate_with_zero_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ldefrate_with_zero.tif&quot;</span><span class="p">),</span>
    <span class="n">blk_rows</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="categories-of-deforestation-risk">
<h2>5 Categories of deforestation risk<a class="headerlink" href="#categories-of-deforestation-risk" title="Permalink to this heading">¶</a></h2>
<p>The fourth step implies converting the continuous values of the raster map of deforestation risk to categorical values. The JNR methodology suggests to use 31 classes of risk from “0” to “30” including the “0” class for the forest pixels with no risk of being deforested (located at a distance to the forest edge <span class="math notranslate nohighlight">\(&gt; d\)</span>, see first step). Following the JNR methodology, at least three slicing algorithms must be compared to derive the categorical map of deforestation risk, such as “equal area”, “equal interval”, and “natural breaks”. With the “equal area” algorithm, each class from “1” to “30” must cover approximately the same area. With the “equal interval” algorithm, classes from “1” to “30” correspond to bins of deforestation risk of the same range. In this case, some risk classes will be in majority in the landscape compared to other classes of lower frequency. With the “natural breaks” algorithm, the continuous deforestation risk is normalized before running an “equal interval” algorithm.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rmj</span><span class="o">.</span><span class="n">defor_cat</span><span class="p">(</span>
    <span class="n">ldefrate_with_zero_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ldefrate_with_zero.tif&quot;</span><span class="p">),</span>
    <span class="n">riskmap_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;riskmap.tif&quot;</span><span class="p">),</span>
    <span class="n">ncat</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Equal Interval&quot;</span><span class="p">,</span>
    <span class="n">blk_rows</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>The risk map can be plotted using the <code class="docutils literal notranslate"><span class="pre">plot.riskmap()</span></code> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ofile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;riskmap.png&quot;</span><span class="p">)</span>
<span class="n">riskmap_fig</span> <span class="o">=</span> <span class="n">rmj</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">riskmap</span><span class="p">(</span>
    <span class="n">input_risk_map</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;riskmap.tif&quot;</span><span class="p">),</span>
    <span class="n">maxpixels</span><span class="o">=</span><span class="mf">1e8</span><span class="p">,</span>
    <span class="n">output_file</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span>
    <span class="n">borders</span><span class="o">=</span><span class="n">border_file</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,)</span>
<span class="n">ofile</span>
</pre></div>
</div>
<figure class="align-default" id="id3">
<span id="fig-steps-riskmap"></span><a class="reference internal image-reference" href="../_images/riskmap.png"><img alt="../_images/riskmap.png" src="../_images/riskmap.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Map of the deforestation risk following the JNR methodology</strong>. Forest pixels are categorized in up to 30 classes of deforestation risk. Forest pixels which belong to the class 0 (in green) are located farther than a distance of 120 m from the forest edge and have a negligible risk of being deforested.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="deforestation-rates-per-category-of-risk">
<h2>6 Deforestation rates per category of risk<a class="headerlink" href="#deforestation-rates-per-category-of-risk" title="Permalink to this heading">¶</a></h2>
<p>Before the validation step, we need to compute the historical deforestation rates (in %/yr) for each category of spatial deforestation risk. The historical deforestation rates are computed for the calibration period (here 2000–2010). Deforestation rates provide estimates of the percentage of forest (which is then converted to an area of forest) that should be deforested inside each forest pixel which belongs to a given category of deforestation risk.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rmj</span><span class="o">.</span><span class="n">defrate_per_cat</span><span class="p">(</span>
    <span class="n">fcc_file</span><span class="o">=</span><span class="n">fcc_file</span><span class="p">,</span>
    <span class="n">defor_values</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">riskmap_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;riskmap.tif&quot;</span><span class="p">),</span>
    <span class="n">time_interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">tab_file_defrate</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;defrate_per_cat.csv&quot;</span><span class="p">),</span>
    <span class="n">blk_rows</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>A table indicating the deforestation rate per category of deforestation is produced:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>cat</p></th>
<th class="head"><p>nfor</p></th>
<th class="head"><p>ndefor</p></th>
<th class="head"><p>rate</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>286897</p></td>
<td><p>0</p></td>
<td><p>0.0</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>11</p></td>
<td><p>6948</p></td>
<td><p>97</p></td>
<td><p>0.13115645793568742</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p>4555</p></td>
<td><p>83</p></td>
<td><p>0.16797929162030611</p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
<td><p>4428</p></td>
<td><p>102</p></td>
<td><p>0.207883556342903</p></td>
</tr>
<tr class="row-odd"><td><p>14</p></td>
<td><p>4079</p></td>
<td><p>158</p></td>
<td><p>0.32635456697582377</p></td>
</tr>
<tr class="row-even"><td><p>15</p></td>
<td><p>3771</p></td>
<td><p>161</p></td>
<td><p>0.35359204117624776</p></td>
</tr>
<tr class="row-odd"><td><p>16</p></td>
<td><p>1733</p></td>
<td><p>102</p></td>
<td><p>0.4548023398767944</p></td>
</tr>
<tr class="row-even"><td><p>17</p></td>
<td><p>2940</p></td>
<td><p>157</p></td>
<td><p>0.4223580050270457</p></td>
</tr>
<tr class="row-odd"><td><p>18</p></td>
<td><p>4178</p></td>
<td><p>230</p></td>
<td><p>0.432341580700236</p></td>
</tr>
<tr class="row-even"><td><p>19</p></td>
<td><p>4028</p></td>
<td><p>262</p></td>
<td><p>0.48960250057719656</p></td>
</tr>
<tr class="row-odd"><td><p>20</p></td>
<td><p>2401</p></td>
<td><p>182</p></td>
<td><p>0.5453769808930122</p></td>
</tr>
<tr class="row-even"><td><p>21</p></td>
<td><p>3654</p></td>
<td><p>317</p></td>
<td><p>0.596469248332768</p></td>
</tr>
<tr class="row-odd"><td><p>22</p></td>
<td><p>1896</p></td>
<td><p>129</p></td>
<td><p>0.5057096122044651</p></td>
</tr>
<tr class="row-even"><td><p>23</p></td>
<td><p>4637</p></td>
<td><p>530</p></td>
<td><p>0.7029181842913952</p></td>
</tr>
<tr class="row-odd"><td><p>24</p></td>
<td><p>3192</p></td>
<td><p>398</p></td>
<td><p>0.7359809944026328</p></td>
</tr>
<tr class="row-even"><td><p>25</p></td>
<td><p>2775</p></td>
<td><p>349</p></td>
<td><p>0.7392177123700654</p></td>
</tr>
<tr class="row-odd"><td><p>26</p></td>
<td><p>5257</p></td>
<td><p>910</p></td>
<td><p>0.8505428722687592</p></td>
</tr>
<tr class="row-even"><td><p>27</p></td>
<td><p>3933</p></td>
<td><p>780</p></td>
<td><p>0.8903521189382809</p></td>
</tr>
<tr class="row-odd"><td><p>28</p></td>
<td><p>4174</p></td>
<td><p>949</p></td>
<td><p>0.9241819269543683</p></td>
</tr>
<tr class="row-even"><td><p>29</p></td>
<td><p>6428</p></td>
<td><p>1870</p></td>
<td><p>0.9678645395136823</p></td>
</tr>
<tr class="row-odd"><td><p>30</p></td>
<td><p>31671</p></td>
<td><p>21848</p></td>
<td><p>0.9999917619641472</p></td>
</tr>
</tbody>
</table>
<p>From this table, we see that the deforestation rate increases with the deforestation risk category and that deforestation rates are spread on the interval [0, 1], suggesting that category 1 represents well a category with very low deforestation risk (equal to 0), and category 30 represents well a category with very high deforestation risk (close to 1).</p>
</section>
<section id="validation">
<h2>7 Validation<a class="headerlink" href="#validation" title="Permalink to this heading">¶</a></h2>
<p>The fifth step focuses on comparing the map of deforestation risk with a deforestation map corresponding to the validation period. The validation period follows the calibration period and provides independent observations of deforestation.</p>
<p>To do so, we consider a square grid of at least 1000 spatial cells containing at least one forest pixel at the beginning of the validation period. Following JNR specification, the cell size should be <span class="math notranslate nohighlight">\(\leq\)</span> 10 km. Note that with the map of deforestation risk, each forest pixel at the beginning of the validation period falls into a category of deforestation risk. For each cell of the grid, we compute the predicted area of deforestation (in ha) given the map of deforestation risk and the historical deforestation rates for each category of deforestation risk computed on the calibration period (see previous step).</p>
<p>We can then compare the predicted deforestation with the observed deforestation in that spatial cell for the validation period. Because all cells don’t have the same forest cover at the beginning of the validation period, a weight <span class="math notranslate nohighlight">\(w_j\)</span> is computed for each grid cell <span class="math notranslate nohighlight">\(j\)</span> such that <span class="math notranslate nohighlight">\(w_j=\beta_j / B\)</span>, with <span class="math notranslate nohighlight">\(\beta_j\)</span> the forest cover (in ha) in the cell <span class="math notranslate nohighlight">\(j\)</span> at the beginning of the validation period and <span class="math notranslate nohighlight">\(B\)</span> the total forest cover in the jurisdiction (in ha) at the same date. We then calculate the weighted root mean squared error (wRMSE) from the observed and predicted deforestation for each cell and the cell weights.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ofile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;pred_obs.png&quot;</span><span class="p">)</span>
<span class="n">rmj</span><span class="o">.</span><span class="n">validation</span><span class="p">(</span>
    <span class="n">fcc_file</span><span class="o">=</span><span class="n">fcc_file</span><span class="p">,</span>
    <span class="n">time_interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">riskmap_file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;riskmap.tif&quot;</span><span class="p">),</span>
    <span class="n">tab_file_defrate</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;defrate_per_cat.csv&quot;</span><span class="p">),</span>
    <span class="n">csize</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
    <span class="n">tab_file_pred</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;pred_obs.csv&quot;</span><span class="p">),</span>
    <span class="n">fig_file_pred</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.4</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">),</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ofile</span>
</pre></div>
</div>
<figure class="align-default" id="id4">
<span id="fig-steps-pred-obs"></span><a class="reference internal image-reference" href="../_images/pred_obs.png"><img alt="../_images/pred_obs.png" src="../_images/pred_obs.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-text"><strong>Relationship between observed and predicted deforestation in 1 x 1 km grid cells</strong>. The red line is the identity line. Values of the weighted root mean squared error (wRMSE, in ha) and of the number of observations (<span class="math notranslate nohighlight">\(n\)</span>, the number of spatial cells) are reported on the graph.</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="final-risk-map">
<h2>8 Final risk map<a class="headerlink" href="#final-risk-map" title="Permalink to this heading">¶</a></h2>
<p>The user must repeat the procedure and obtain risk maps for various window size and slicing algorithms. Following the JNR methodology, at least 25 different sizes for the moving window must be tested together with two slicing algorithms (“Equal Interval” and “Equal Area”), thus leading to a minimum of 50 different maps of deforestation risk. The map with the smallest wRMSE value is considered the best risk map. Once the best risk map is identified, with the corresponding window size and slicing algorithm, a final risk map is derived considering both the calibration and validation period (see the <a class="reference external" href="https://ecology.ghislainv.fr/riskmapjnr/notebooks/get_started.html">Get Started</a> tutorial).</p>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2022, Ghislain Vieilledent.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/notebooks/steps.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>